<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RSS Feed Combiner</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 1rem; }
  input[type="text"] { width: 100%; padding: 8px; margin-bottom: 10px; font-size: 1rem; }
  label { display: block; margin: 5px 0; }
  #feeds-list { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 5px; }
  button { padding: 10px 15px; font-size: 1rem; cursor: pointer; }
</style>
</head>
<body>

<h1>RSS Feed Combiner</h1>
<p>Search and select RSS feeds you want combined.</p>

<input type="text" id="search" placeholder="Search feeds (e.g., TechCrunch, BBC)" />

<form method="POST" action="/generate" id="feeds-form">
  <div id="feeds-list">
    <!-- Checkboxes generated by JS -->
  </div>
  <input type="hidden" name="feeds" id="selected-feeds" />
  <button type="submit">Generate Combined RSS Link</button>
</form>

<script>
  const feeds = {{ feeds|tojson }};
  const feedsList = document.getElementById('feeds-list');
  const searchInput = document.getElementById('search');
  const selectedFeedsInput = document.getElementById('selected-feeds');
  const form = document.getElementById('feeds-form');

  function renderFeeds(filter = "") {
    feedsList.innerHTML = "";
    const filtered = feeds.filter(f => f.toLowerCase().includes(filter.toLowerCase()));
    filtered.forEach(feed => {
      const id = "feed-" + feed.replace(/\W+/g, "-");
      const label = document.createElement('label');
      label.htmlFor = id;
      label.innerHTML = `<input type="checkbox" id="${id}" value="${feed}"> ${feed}`;
      feedsList.appendChild(label);
    });
  }

  searchInput.addEventListener('input', e => {
    renderFeeds(e.target.value);
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    const checked = Array.from(feedsList.querySelectorAll('input[type="checkbox"]:checked'))
      .map(cb => cb.value);
    if(checked.length === 0) {
      alert("Select at least one feed.");
      return;
    }
    selectedFeedsInput.value = checked.join(",");
    form.submit();
  });

  // Initial render all feeds
  renderFeeds();
</script>

</body>
</html>
